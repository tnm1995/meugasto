{"version":3,"file":"Profile-DsVRqPRb.js","sources":["../../components/Profile.tsx"],"sourcesContent":["\nimport React, { useState, useCallback, useEffect } from 'react';\nimport type { User } from '../types';\nimport { PremiumIcon, ChevronRightIcon, LogoutIcon, PolicyIcon, DescriptionIcon, SupportAgentIcon, TrophyIcon } from './Icons'; // Adicionado TrophyIcon\nimport { DEFAULT_PROFILE_IMAGE, getLevelInfo } from '../types'; // Import from types.ts, adicionado getLevelInfo\nimport { useToast } from '../contexts/ToastContext'; // Importa useToast\n\ninterface ProfileProps {\n  userProfile: User; \n  handleLogout: () => void;\n  onManageSubscription: () => void;\n  onUpdateProfileImage: (newImage: string) => Promise<boolean>;\n  isLoading: boolean;\n  onOpenPrivacyPolicy: () => void;\n  onOpenTermsOfService: () => void;\n  onOpenSupport: () => void;\n}\n\nconst compressImage = (file: File, maxWidth: number, maxHeight: number, quality: number, mimeType: string = 'image/jpeg'): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = (event) => {\n      const img = new Image();\n      img.src = event.target?.result as string;\n      img.onload = () => {\n        const canvas = document.createElement('canvas');\n        let width = img.width;\n        let height = img.height;\n\n        // Calculate aspect ratio and resize\n        if (width > height) {\n          if (width > maxWidth) {\n            height = Math.round((height *= maxWidth / width));\n            width = maxWidth;\n          }\n        } else {\n          if (height > maxHeight) {\n            width = Math.round((width *= maxHeight / height));\n            height = maxHeight;\n          }\n        }\n\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n          return reject(new Error('Could not get canvas context.'));\n        }\n        ctx.drawImage(img, 0, 0, width, height);\n\n        // Convert canvas to base64 with specified quality and mimeType\n        resolve(canvas.toDataURL(mimeType, quality));\n      };\n      img.onerror = (err) => reject(err);\n    };\n    reader.onerror = (err) => reject(err);\n  });\n};\n\n\nexport const Profile: React.FC<ProfileProps> = ({ \n  userProfile, \n  handleLogout, \n  onManageSubscription, \n  onUpdateProfileImage, \n  isLoading,\n  onOpenPrivacyPolicy,\n  onOpenTermsOfService,\n  onOpenSupport,\n}) => {\n  const [fileInputKey, setFileInputKey] = useState(Date.now()); // Key to force re-render of file input\n  const { showToast } = useToast(); // Hook para mostrar toasts\n\n  const handleImageChange = useCallback(async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // 1. Validação de Tipo MIME\n      if (!file.type.startsWith('image/')) {\n        showToast('Formato de arquivo inválido. Por favor, selecione uma imagem (JPG, PNG, GIF).', 'error');\n        setFileInputKey(Date.now()); // Reset input\n        return;\n      }\n\n      // 2. Validação de Tamanho do Arquivo Original (antes da compressão)\n      const MAX_ORIGINAL_FILE_SIZE_BYTES = 5 * 1024 * 1024; // 5 MB\n      if (file.size > MAX_ORIGINAL_FILE_SIZE_BYTES) {\n        showToast(`A imagem original é muito grande (${Math.round(file.size / (1024 * 1024))}MB). Selecione uma imagem menor (limite de 5MB).`, 'error');\n        setFileInputKey(Date.now()); // Reset input\n        return;\n      }\n\n      try {\n        const MAX_IMAGE_PIXELS = 512; // Max width/height for display\n        const JPEG_QUALITY = 0.4; // Qualidade para compressão (40%)\n\n        const compressedImage = await compressImage(file, MAX_IMAGE_PIXELS, MAX_IMAGE_PIXELS, JPEG_QUALITY, file.type); \n        \n        // 3. Validação de Tamanho da String Base64 Pós-Compressão\n        const MAX_BASE64_STRING_LENGTH_BYTES = 900 * 1024; // ~900KB Base64 string (characters)\n\n        if (compressedImage.length > MAX_BASE64_STRING_LENGTH_BYTES) {\n          const currentSizeKB = Math.round(compressedImage.length / 1024);\n          const limitKB = Math.round(MAX_BASE64_STRING_LENGTH_BYTES / 1024);\n          showToast(`A imagem (${currentSizeKB}KB) ainda é muito grande após a otimização para 512x512 pixels. O limite é de ${limitKB}KB. Por favor, tente uma imagem com menos detalhes ou menor resolução original.`, 'error');\n          setFileInputKey(Date.now()); // Reset input\n          return;\n        }\n\n        const success = await onUpdateProfileImage(compressedImage); \n\n        if (success) {\n          showToast('Foto de perfil atualizada com sucesso!', 'success');\n        } else {\n          showToast('Erro ao atualizar foto de perfil no servidor. Tente novamente.', 'error');\n        }\n        setFileInputKey(Date.now()); // Update key to clear input value\n      } catch (error) {\n        console.error('Profile Debug: Erro ao comprimir ou fazer upload da imagem:', error);\n        showToast('Erro ao atualizar foto de perfil. Verifique o formato ou tente uma imagem menor.', 'error');\n      }\n    }\n  }, [onUpdateProfileImage, showToast]);\n\n  const triggerFileInput = useCallback(() => {\n    const fileInput = document.getElementById('profile-image-upload');\n    if (fileInput) {\n      fileInput.click();\n    }\n  }, []);\n\n  const effectiveProfileImage = userProfile.profileImage || DEFAULT_PROFILE_IMAGE;\n  const effectiveUserName = userProfile.name || userProfile.email?.split('@')[0] || 'Usuário';\n\n  // Gamification Info\n  const levelInfo = getLevelInfo(userProfile.xp || 0);\n\n  if (isLoading && (!userProfile || !userProfile.uid)) { \n    return (\n        <div className=\"p-4 flex flex-col items-center justify-center min-h-[calc(100vh-120px)] text-center text-gray-500\">\n            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mb-4\"></div>\n            <p className=\"text-lg\">Carregando perfil...</p>\n        </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 space-y-6\">\n      <div className=\"bg-white p-6 rounded-2xl shadow-sm flex flex-col items-center\">\n        <div className=\"relative w-28 h-28 mb-4 shrink-0 aspect-square\">\n          <img \n            src={effectiveProfileImage} \n            alt=\"Foto de Perfil\" \n            className=\"w-full h-full rounded-full object-cover border-4 border-blue-200\"\n          />\n          <button \n            onClick={triggerFileInput}\n            className=\"absolute bottom-0 right-0 bg-blue-500 text-white rounded-full p-2 text-sm shadow-md hover:bg-blue-600 transition-colors shrink-0 aspect-square flex items-center justify-center\"\n            aria-label=\"Alterar foto de perfil\"\n          >\n            <span className=\"material-symbols-outlined\">photo_camera</span>\n          </button>\n          <input \n            key={fileInputKey} \n            id=\"profile-image-upload\" \n            type=\"file\" \n            accept=\"image/*\" \n            className=\"hidden\" \n            onChange={handleImageChange} \n            aria-label=\"Upload de nova foto de perfil\"\n          />\n        </div>\n        <h2 className=\"text-xl font-bold text-gray-800\">{effectiveUserName}</h2>\n        <p className=\"text-gray-500 text-sm mb-4\">{userProfile.email}</p>\n        \n        {/* Gamification Badge in Profile */}\n        <div className=\"flex items-center gap-2 bg-yellow-50 px-4 py-2 rounded-full border border-yellow-100\">\n            <TrophyIcon className=\"text-yellow-600\" />\n            <span className=\"text-sm font-bold text-yellow-800\">{levelInfo.title} (Nível {levelInfo.level})</span>\n        </div>\n      </div>\n\n      <div className=\"bg-white p-6 rounded-2xl shadow-sm space-y-4\">\n        <h3 className=\"text-lg font-semibold text-gray-700\">Configurações</h3>\n        <button onClick={onManageSubscription} className=\"flex items-center justify-between w-full py-3 px-2 rounded-lg hover:bg-gray-50 transition-colors\" aria-label=\"Gerenciar assinatura premium\">\n          <div className=\"flex items-center\">\n            <PremiumIcon className=\"text-blue-600 text-xl mr-3\" />\n            <span className=\"font-medium text-gray-700\">Assinatura Premium</span>\n          </div>\n          <ChevronRightIcon className=\"text-lg text-gray-400\" />\n        </button>\n        <button onClick={onOpenPrivacyPolicy} className=\"flex items-center justify-between w-full py-3 px-2 rounded-lg hover:bg-gray-50 transition-colors\" aria-label=\"Ver política de privacidade\">\n          <div className=\"flex items-center\">\n            <PolicyIcon className=\"text-purple-600 text-xl mr-3\" />\n            <span className=\"font-medium text-gray-700\">Política de Privacidade</span>\n          </div>\n          <ChevronRightIcon className=\"text-lg text-gray-400\" />\n        </button>\n        <button onClick={onOpenTermsOfService} className=\"flex items-center justify-between w-full py-3 px-2 rounded-lg hover:bg-gray-50 transition-colors\" aria-label=\"Ver termos de serviço\">\n          <div className=\"flex items-center\">\n            <DescriptionIcon className=\"text-indigo-600 text-xl mr-3\" />\n            <span className=\"font-medium text-gray-700\">Termos de Serviço</span>\n          </div>\n          <ChevronRightIcon className=\"text-lg text-gray-400\" />\n        </button>\n        <button onClick={onOpenSupport} className=\"flex items-center justify-between w-full py-3 px-2 rounded-lg hover:bg-gray-50 transition-colors\" aria-label=\"Entrar em contato com o suporte\">\n          <div className=\"flex items-center\">\n            <SupportAgentIcon className=\"text-teal-600 text-xl mr-3\" />\n            <span className=\"font-medium text-gray-700\">Suporte</span>\n          </div>\n          <ChevronRightIcon className=\"text-lg text-gray-400\" />\n        </button>\n      </div>\n\n      <div className=\"bg-white p-6 rounded-2xl shadow-sm\">\n        <button onClick={handleLogout} className=\"flex items-center w-full py-3 px-2 text-red-600 font-medium rounded-lg hover:bg-red-50 transition-colors\" aria-label=\"Sair da conta\">\n          <LogoutIcon className=\"text-xl mr-3\" />\n          Sair\n        </button>\n      </div>\n    </div>\n  );\n};"],"names":["compressImage","file","maxWidth","maxHeight","quality","mimeType","resolve","reject","reader","event","img","_a","canvas","width","height","ctx","err","Profile","userProfile","handleLogout","onManageSubscription","onUpdateProfileImage","isLoading","onOpenPrivacyPolicy","onOpenTermsOfService","onOpenSupport","fileInputKey","setFileInputKey","useState","showToast","useToast","handleImageChange","useCallback","MAX_ORIGINAL_FILE_SIZE_BYTES","compressedImage","MAX_BASE64_STRING_LENGTH_BYTES","currentSizeKB","limitKB","error","triggerFileInput","fileInput","effectiveProfileImage","DEFAULT_PROFILE_IMAGE","effectiveUserName","levelInfo","getLevelInfo","jsxs","jsx","TrophyIcon","PremiumIcon","ChevronRightIcon","PolicyIcon","DescriptionIcon","SupportAgentIcon","LogoutIcon"],"mappings":"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"}